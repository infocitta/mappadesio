<!DOCTYPE html>
<html ng-app="ngMap">
<head>
<title>Mappa Desio</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.2.0/sandstone/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
<script src="https://maps.google.com/maps/api/js?libraries=placeses,visualization,drawing,geometry,places&key=AIzaSyDMQX5Qu93BAwKBvSqO-pzUGMcIpWghu_o"></script>
<script src="https://code.angularjs.org/1.3.15/angular.js"></script>
<script src="https://rawgit.com/allenhwkim/angularjs-google-maps/master/build/scripts/ng-map.js"></script>

<style>
  ng-map {
  position:absolute;
  width: 100%;
  height: 100%;
}
.modal {
  display: block;
  z-index: -1;
}
.modal.fade.in {
  z-index: 1050;
}
</style>

<script>
angular.module('ngMap').controller('MyCtrl', function($scope,$http,NgMap) {
  
  NgMap.getMap().then(function(map) {
    $scope.map = map;
  });
  $http.get("https://mappadesio.infocitta.info/poi.json")
    .then(function(response) {
        $scope.pois = response.data;
    });	

  $scope.showPOI = function(event, poi) {
    $scope.selectedPOI = poi;
    $scope.map.showInfoWindow('myInfoWindow', this);
  };

});
</script>
</head>

<body>

<div ng-controller="MyCtrl as vm">

  <ng-map   map-type-control="false" default-style="false" zoom="16" center="45.618600, 9.207690" >
	<marker position="current" animation="Animation.BOUNCE" title="Tua posizione" icon="{url:'man.png'}"></marker>
    <info-window id="myInfoWindow" >
      <div ng-non-bindable>
        <div style="padding: 10px;"><h4>{{selectedPOI.Address}}</h4>
        <small>{{selectedPOI.Note}}</small></div>
	<a ng-href="https://www.google.com/maps?q={{selectedPOI.Latitude}},{{selectedPOI.Longitude}}" class="btn btn-info" role="button">Posizione</a>
	<a ng-href="https://www.google.com/maps/dir/Current+Location/{{selectedPOI.Latitude}},{{selectedPOI.Longitude}}" class="btn btn-info" role="button">Indicazioni</a>
      </div> 
    </info-window>
	<div ng-repeat="c in pois[0].Categories">
    <marker ng-repeat="p in c.Locations" 
      position="{{p.Latitude}},{{p.Longitude}}" title="{{p.Address}}"  id="POI_{{$index}}"  on-click="showPOI(event, p)"
      icon="{
        url:'{{c.Icon}}'
      }"
      
      >
    </marker>
	</div>
	<custom-control id="title" position="TOP_LEFT" index="1">
	<div style="padding: 10px;">
	<h3><b>Città di Desio</b></h3>
	<p>Punti di interesse</p>
	</div>
	</custom-control>    
	<custom-control id="by" position="BOTTOM_LEFT" index="1">
		<div style="padding: 10px;">Created by Paolo Fisco @ipersoft</div>
	</custom-control> 
	<custom-control id="by" position="TOP_RIGHT" index="1">
		<div ng-repeat="c in pois[0].Categories" style="padding: 10px;background-color: white;"><img ng-src="{{c.Icon}}" style="width:16px;height:16px">{{c.Category}}</div>
	</custom-control> 	
  </ng-map>



  </div>
</body>
</html>
